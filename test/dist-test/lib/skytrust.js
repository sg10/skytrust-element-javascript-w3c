/*! skytrust-javascript-element - v1.0.0 - 2015-04-07
* Copyright (c) 2015 Stefan Gruber; Licensed MIT */
define("common/crypto-object",[],function(){var e=function(e){var t={},r={},o=-1;this.resolve=function(){},this.reject=function(){},this.setHeader=function(e){t=JSON.parse(JSON.stringify(e))},this.getHeader=function(){return t},this.setPayload=function(e){r=JSON.parse(JSON.stringify(e))},this.getPayload=function(){return r},this.setRequestID=function(e){o=e},this.getRequestID=function(){return o},this.json=function(){return JSON.stringify({header:t,payload:r})},this.jsonWithRequestID=function(){return JSON.stringify({header:t,payload:r,requestID:o})},this.toString=function(){return"[CryptoObject #"+o+"] header="+t+", payload="+r},e&&this.setPayload(e)};return e}),define("common/router",["require","../common/crypto-object"],function(e){var t=e("../common/crypto-object"),r=function(e){var r="";if(this.route=function(e,o,n){if(console.log("[common][router]  FROM="+e+" TO="+o),!(n instanceof t))throw new Error("Router can only transmit instances of CryptoObject");if(r.getComponent(o)===!1)throw new Error("Router, receiver: no component named "+o);if(r.getComponent(e)===!1)throw new Error("Router, sender: no component named "+e);if(!r.getComponent(o).onReceive)throw new Error("Router: onReceive() method not defined");r.getComponent(o).onReceive(n)},this.window===window)throw Error("Router called statically");r=e};return r}),define("common/component",[],function(){var e=function(){return this.window===window?!1:void 0};return e.prototype.send=function(e,t){console.log("[WARNING] abstract method was not overwritten"),console.log("to="+e+", object="+t)},e.prototype.onReceive=function(e){console.log("[WARNING] abstract method was not overwritten"),console.log("object="+e)},e}),define("common/error",[],function(){var e=function(e){Error.call(this),this.name="NotYetImplementedException",this.message=e,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};e.prototype=Object.create(Error.prototype);var t=function(){Error.call(this),this.name="NoSuchProviderError",this.message="Provider does not exist.",this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};t.prototype=Object.create(Error.prototype);var r=function(){Error.call(this),this.name="UnauthorizedError",this.message="Please authorize, no active or invalid session.",this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};r.prototype=Object.create(Error.prototype);var o=function(e){Error.call(this),this.name="QuotaExceededError",this.message=e,this.code=22,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};o.prototype=Object.create(Error.prototype);var n=function(){Error.call(this),this.name="InvalidAccessError",this.message="The requested operation is not valid for the provided key.",this.code=15,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};n.prototype=Object.create(Error.prototype);var i=function(){Error.call(this),this.name="SyntaxError",this.message="A required parameter was missing or out-of-range",this.code=12,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};i.prototype=Object.create(Error.prototype);var s=function(e){Error.call(this),this.name="NotSupportedError",this.message="This algorithm is not supported: "+e,this.code=9,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};s.prototype=Object.create(Error.prototype);var a=function(){Error.call(this),this.name="OperationNotSupported",this.message="SkyTrust doesn't support this operation.",this.code=9,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};a.prototype=Object.create(Error.prototype);var c=function(){Error.call(this),this.name="InvalidStateError",this.message="The requested operation is not valid for the current state of the provided key.",this.code=11,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};c.prototype=Object.create(Error.prototype);var u=function(){Error.call(this),this.name="OperationError",this.message="The operation failed for an operation-specific reason.",this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};u.prototype=Object.create(Error.prototype);var p=function(){Error.call(this),this.name="UnknownError",this.message="The operation failed for an unknown transient reason (e.g. out of memory).",this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};p.prototype=Object.create(Error.prototype);var d=function(){Error.call(this),this.name="DataError",this.message="Data provided to an operation does not meet requirements.",this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};d.prototype=Object.create(Error.prototype);var l=function(e){Error.call(this),this.name="TypeMismatchError",this.message=e,this.stack=(new Error).stack,this.toString=function(){return"Error: "+this.name+": "+this.message}};return l.prototype=Object.create(Error.prototype),{NotYetImplementedException:e,NoSuchProviderError:t,UnauthorizedError:r,QuotaExceededError:o,InvalidStateError:c,SyntaxError:i,OperationNotSupportedError:a,NotSupportedError:s,InvalidAccessError:n,OperationError:u,UnknownError:p,DataError:d,TypeMismatchError:l}}),define("common/util",["require","../common/error"],function(e){var t=e("../common/error"),r={};return r.atob=function(e){if("string"==typeof plainTextData)return window.atob(e);for(var t=[],r=0;r<e.length;r++)t.push(window.atob(e[r]));return t},r.btoa=function(e){if("string"==typeof e)return window.btoa(e);for(var t=[],r=0;r<e.length;r++)t.push(window.btoa(e[r]));return t},r.inArray=function(e,t){if(!t||!t.length)return!1;for(var r=e.toLowerCase(),o=0;o<t.length;o++)if(r===t[o].toLowerCase())return t[o];return!1},r.copyOf=function(e){var t;if("string"==typeof e)return""+e;if("number"==typeof e||"boolean"==typeof e)return e;if("[object Date]"===Object.prototype.toString.call(e))return t=new Date,t.setTime(e.getTime()),t;if(Array.isArray(e)){t=[];for(var o=0;o<e.length;o++)t[o]=r.copyOf(e[o]);return t}if("object"==typeof e||e instanceof Object)return $.extend(!0,{},e);throw new Error("Copying type "+typeof e+" is not supported!")},r.rejectedPromise=function(e){return new Promise(function(t,r){r(e)})},r.warningIfNotNull=function(e){$.each(e,function(e,t){null!=t&&console.warn("Parameter '"+e+"' is not used via this API. To disable this warning, set it to null.")})},r.throwNotSupportedError=function(){throw new t.OperationNotSupportedError},r}),define("common/protocol",["require","../common/util"],function(e){var t=e("../common/util"),r={},o=function(e,t){var r=t.split("."),o=e;try{for(var n=0;n<r.length;n++){if(!o.hasOwnProperty(t[n]))throw new Error;o=o[t[n]]}}catch(i){throw new Error("key '"+t+"' does not exist")}return o},n=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return i(e);for(var t=[],r=0;r<e.length;r++)t.push(i(e[r]));return t},i=function(e){if(null==e||!e.keyType)return null;var t={type:e.keyType};return("handle"===e.keyType||"internalCertificate"===e.keyType)&&(t.id=e.id,t.subId=e.subId),"internalCertificate"===e.keyType&&(t.encodedCertificate=e.encodedCertificate),"wrappedKey"===e.keyType&&(t.encodedWrappedKey=e.encodedWrappedKey),"externalCertificate"===e.keyType&&(t.encodedCertificate=e.encodedCertificate),t};return r.getBlankHeader=function(){var e={type:"standardSkyTrustHeader",commandId:"",sessionId:"",path:["java-api-instance"],protocolVersion:"2.0"};return e},r.setBlankHeader=function(e){e.setHeader(r.getBlankHeader())},r.setDiscoverKeysRequest=function(e){var t={type:"discoverKeysRequest",representation:"handle"};e.setPayload&&e.setPayload(t)},r.setSessionId=function(e,t){if(e.getHeader){var r=e.getHeader();r.sessionId=t,e.setHeader(r)}else e.sessionId=t},r.getSessionId=function(e){return e.getHeader?o(e.getHeader(),"sessionId"):void 0},r.setUserPasswortAuth=function(e,t,r){var o={type:"authChallengeResponse",authInfo:{type:"UserNamePasswordAuthInfo",userName:t,passWord:r}};e.setPayload&&e.setPayload(o)},r.setEncryptRequest=function(e,r,o,n){var s=t.btoa(n),a={type:"encryptRequest",encryptionKeys:[i(o)],algorithm:r,plainData:"string"==typeof s?[s]:s};e.setPayload&&e.setPayload(a)},r.setDecryptRequest=function(e,t,r,o){var n={type:"decryptRequest",decryptionKey:i(r),algorithm:t,encryptedData:"string"==typeof o?[o]:o};e.setPayload&&e.setPayload(n)},r.setEncryptCMSRequest=function(e,r,o,n){var s=t.btoa(n),a={type:"encryptCMSRequest",encryptionKeys:[i(o)],algorithm:r,plainData:"string"==typeof s?[s]:s};e.setPayload&&e.setPayload(a)},r.setDecryptCMSRequest=function(e,t,r,o){var n={type:"decryptCMSRequest",decryptionKey:i(r),encryptedCMSData:"string"==typeof o?[o]:o};e.setPayload&&e.setPayload(n)},r.setSignRequest=function(e,r,o,n){var s=t.btoa(n),a={type:"signRequest",signatureKey:i(o),algorithm:r,hashesToBeSigned:"string"==typeof s?[s]:s};e.setPayload&&e.setPayload(a)},r.setGenerateWrappedKeyRequest=function(e,t,r,o,s){var a=i(o),c={type:"generateWrappedKeyRequest",encryptionKeys:n(r),keyType:t,certificateSubject:s};null!=a&&(c.signingKey=a),e.setPayload&&e.setPayload(c)},r.isAuthRequired=function(e){var t=e.getPayload();return t&&"authChallengeRequest"===t.type?!0:!1},r.getAuthTypes=function(e){for(var t=e.getPayload().authTypes,r=[],o=0;t&&o<t.length;o++)r.push(t[o].type);return r},r.getError=function(e){var t=e.getPayload();return t&&"status"===t.type?t.code:!1},r.getCommandId=function(e){return e.getHeader?e.getHeader().commandId:e.commandId},r.setCommandId=function(e,t){e.getHeader||(e.commandId=t),e.getHeader().commandId=t},r.supportedAlgorithms={encrypt:["RSA-OAEP","RSAES-PKCS1-v1_5","RSAES-RAW"],sign:["RSASSA-PKCS1-v1_5-SHA-1","RSASSA-PKCS1-v1_5-SHA-224","RSASSA-PKCS1-v1_5-SHA-256","RSASSA-PKCS1-v1_5-SHA-512"],cms:["CMS-AES-128-CBC","CMS-AES-192-CBC","CMS-AES-256-CBC","CMS-AES-128-GCM","CMS-AES-192-GCM","CMS-AES-256-GCM","CMS-AES-128-CCM","CMS-AES-192-CCM","CMS-AES-256-CCM"],wrapped:["RSA-2048","RSA-4096"]},r}),define("common/key",["require","./util"],function(e){var t=e("./util"),r=function(e,o,n,i){if(!(this instanceof r))throw new Error("CryptoKey called statically");if(t.warningIfNotNull({algo:e,usages:o}),Object.defineProperty(this,"keyType",{value:n}),"handle"===n||"internalCertificate"===n)Object.defineProperty(this,"id",{value:i.id}),Object.defineProperty(this,"subId",{value:i.subId}),"internalCertificate"===n&&Object.defineProperty(this,"encodedCertificate",{value:i.encodedCertificate}),Object.defineProperty(this,"extractable",{value:!1});else if("wrappedKey"===n)Object.defineProperty(this,"encodedWrappedKey",{value:i.encodedWrappedKey}),Object.defineProperty(this,"encodedX509Certificate",{value:i.encodedX509Certificate}),Object.defineProperty(this,"extractable",{value:!0});else{if("externalCertificate"!==n)throw new Error("Invalid keyType specified");Object.defineProperty(this,"encodedCertificate",{value:i.encodedCertificate}),Object.defineProperty(this,"extractable",{value:!0})}Object.defineProperty(this,"type",{value:"secret"}),Object.defineProperty(this,"algorithm",{value:e}),Object.defineProperty(this,"usages",{value:o})};return r.prototype.toString=function(){var e="[CryptoKey] ";return"handle"===this.keyType||"encodedCertificate"===this.keyType?(e=e+"id="+this.id+", subId="+this.subId,"internalCertificate"===this.keyType&&(e=e+" certificate="+this.encodedCertificate.substr(0,8)+"...")):"wrappedKey"===this.keyType?e=e+"wrappedKey="+this.encodedWrappedKey.substr(0,3)+"..."+this.encodedWrappedKey.substr(550,7)+"...":"externalCertificate"===this.keyType&&(e=e+"certificate="+this.encodedCertificate.substr(0,3)+"..."+this.encodedCertificate.substr(550,7)+"..."),e},r}),define("w3ccrypto/receiver",["require","../common/component","../common/crypto-object","../common/protocol","../skytrust-config","../common/util","../common/error","../common/key"],function(e){var t=e("../common/component"),r=e("../common/crypto-object"),o=e("../common/protocol"),n=(e("../skytrust-config"),e("../common/util")),i=e("../common/error"),s=e("../common/key"),a=function(){var e=this,t=function(e,t){var r=e.name?e.name:e;r=(""+r).toLowerCase();var s=(""+t).toLowerCase(),a="decrypt"===s?"encrypt":s,c=o.supportedAlgorithms[a],u=n.inArray(r,c);if(!c||!u)throw new i.NotSupportedError(r);return u},a=function(o,i,a,c,u){if(s)try{a=t(a,i)}catch(p){return n.rejectedPromise(p)}return new Promise(function(t,n){var i=new r;o(i,a,c,u),i.resolve=t,i.reject=n,e.send("communication",i)})},c={encrypt:{request:function(e,t,r){return a(o.setEncryptRequest,"encrypt",e,t,n.copyOf(r))},response:function(e,t){t.encryptedData[0]&&t.encryptedData[0][0]?e.resolve(t.encryptedData[0][0]):e.rejected(new Error("skyTrust error"))}},decrypt:{request:function(e,t,r){return a(o.setDecryptRequest,"decrypt",e,t,n.copyOf(r))},response:function(e,t){e.resolve(window.atob(t.plainData[0]))}},sign:{request:function(e,t,r){return a(o.setSignRequest,"sign",e,t,n.copyOf(r))},response:function(e,t){e.resolve(t.signedHashes[0])}},encryptCMS:{request:function(e,t,r){return a(o.setEncryptCMSRequest,"cms",e,t,n.copyOf(r))},response:function(e,t){e.resolve(t.encryptedCMSData)}},decryptCMS:{request:function(e,t,r){return a(o.setDecryptCMSRequest,"cms",e,t,n.copyOf(r))},response:function(e,t){e.resolve(n.atob(t.plainData))}},discoverKeys:{request:function(){return new Promise(function(t,n){var i=new r;o.setDiscoverKeysRequest(i),i.resolve=t,i.reject=n,e.send("communication",i)})},response:function(e,t){for(var r=t.key,o=[],n=0;n<r.length;n++){var i={id:r[n].id,subId:r[n].subId};o.push(new s(null,null,"handle",i))}e.resolve(o)}},generateWrappedKey:{request:function(i,s,a,c){var u=n.copyOf(c);try{i=t(i,"wrapped")}catch(p){return rejectedPromise(p)}return new Promise(function(t,n){var c=new r;o.setGenerateWrappedKeyRequest(c,i,s,a,u),c.resolve=t,c.reject=n,e.send("communication",c)})},response:function(e,t){var r=new s(null,null,"wrappedKey",t);e.resolve(r)}},exportKey:function(e,t){return new Promise(function(r,o){t instanceof s||o(new Error("invalid CryptoKey object")),t.extractable!==!0&&o(new i.InvalidAccessError),"x509"===e?r({key:t.encodedWrappedKey,certificate:t.encodedX509Certificate}):o(new Error("export format has to be x509"))})},importKey:function(e,t){n.copyOf(t);return new Promise(function(t,r){"x509"===e||"id"===e||r(new i.NotSupportedError(e))})}};this.onReceive=function(e){console.log("[w3c   ] received at receiver component"),console.log(e.json());var t=o.getError(e);if(t!==!1)e.reject(new Error("SkyTrust/HTTP error code "+t));else{var r=e.getPayload(),n=r.type,i={decryptResponse:c.decrypt.response,encryptResponse:c.encrypt.response,signResponse:c.sign.response,encryptCMSResponse:c.encryptCMS.response,decryptCMSResponse:c.decryptCMS.response,discoverKeysResponse:c.discoverKeys.response,generateWrappedKeyResponse:c.generateWrappedKey.response};try{i[n](e,r)}catch(s){e.reject(s)}}},this.operation={encrypt:c.encrypt.request,decrypt:c.decrypt.request,sign:c.sign.request,encryptCMS:c.encryptCMS.request,decryptCMS:c.decryptCMS.request,discoverKeys:c.discoverKeys.request,generateWrappedKey:c.generateWrappedKey.request,exportKey:c.exportKey,importKey:c.importKey}};return a.prototype=Object.create(t),a}),define("w3ccrypto/communication",["require","../common/component","../common/protocol"],function(e){var t=e("../common/component"),r=e("../common/protocol"),o=function(e){var t="",o=this,n={},i=!1,s=function(){console.log("[w3c   ] init post message listener"),window.addEventListener("message",p,!1)},a=function(e){var r=document.getElementById(t);console.log("[w3c   ] data to send: "),console.log(e.json());var o="";do o=Math.round(1e6*Math.random());while(n.hasOwnProperty(o));e.setRequestID(o),n[o]=e;var s=e.jsonWithRequestID();if(i===!1)var a=window.setInterval(function(){i===!0&&(window.clearInterval(a),r.contentWindow.postMessage(s,"*"))},500);else r.contentWindow.postMessage(s,"*");console.log("[w3c   ] pending requests: "+Object.keys(n).length)},c=function(e){var t=n[e];return n[e]&&delete n[e],t},u=function(e){console.log("[w3c   ] sending post message to iframe ..."),a(e)},p=function(e){console.log("[w3c   ] received post message ..."),console.log("[w3c   ] postMessage origin: "+e.origin),console.log("[w3c   ] postMessage data:"),console.log(e.data);var t=JSON.parse(e.data),r=c(t.requestID);if(!r)throw new Error("no matching request with ID '"+t.requestID+"' found!");r.setPayload(t.payload),r.setHeader(t.header),o.send("receiver",r)};if(this.onReceive=function(e){console.log("[w3c   ] received at communication component"),r.setBlankHeader(e),u(e)},this.start=function(){i=!0},this.window===window)throw new Error("Communication called statically");t=e,s()};return o.prototype=Object.create(t),o}),define("w3ccrypto/element",["require","../common/router","../w3ccrypto/receiver","../w3ccrypto/communication","jQuery"],function(e){var t=e("../common/router"),r=e("../w3ccrypto/receiver"),o=e("../w3ccrypto/communication"),n=e("jQuery");return function(){var i={},s=new t(this),a="skytrust-iframe",c=e.toUrl("skytrust-iframe.html"),u=function(e,t){return i.hasOwnProperty(e)?!1:(i[e]=t,void(t.send=function(t,r){s.route(e,t,r)}))},p=function(){console.log("[w3c   ] IFrame target loaded"),i.communication.start()};if(this.operation={},this.getComponent=function(e){return i.hasOwnProperty(e)?i[e]:!1},this.window===window)throw Error("Element called statically");n(document).ready(function(){console.log("[w3c   ] loading iframe target ..."),n("#"+a).attr("src",c),n("#"+a).on("load",p)}),u("receiver",new r),u("communication",new o(a)),this.operation=i.receiver.operation}}),define("w3ccrypto/provider",["require","../w3ccrypto/element","../common/error","../common/key","../common/util"],function(e){var t=e("../w3ccrypto/element"),r=e("../common/error"),o=e("../common/key"),n=e("../common/util"),i=null,s=function(){null===i&&(i=new t),this.subtle={},this.extended={},this.subtle.CryptoKey=o,this.subtle.encrypt=function(e,t,r){return i.operation.encrypt(e,t,r)},this.subtle.decrypt=function(e,t,r){return i.operation.decrypt(e,t,r)},this.subtle.sign=function(e,t,r){return i.operation.sign(e,t,r)},this.subtle.generateKey=function(e,t,r,o,s,a){return n.warningIfNotNull({extractable:t,keyUsages:r}),i.operation.generateWrappedKey(e,o,s,a)},this.subtle.exportKey=function(e,t){return i.operation.exportKey(e,t)},this.subtle.importKey=function(e,t,r,o,s){return n.warningIfNotNull({algorithm:r,extractable:o,keyUsages:s}),i.operation.exportKey(e,t)},this.subtle.deriveKey=n.throwNotSupportedError,this.subtle.deriveBits=n.throwNotSupportedError,this.subtle.verify=n.throwNotSupportedError,this.subtle.digest=n.throwNotSupportedError,this.subtle.wrapKey=function(){throw new r.NotYetImplementedException},this.subtle.unwrapKey=function(){throw new r.NotYetImplementedException},this.extended.listKeys=i.operation.discoverKeys,this.extended.encryptCMS=i.operation.encryptCMS,this.extended.decryptCMS=i.operation.decryptCMS};return s}),define("w3ccrypto/providerDef",["require","../w3ccrypto/provider","../common/error"],function(e){var t=e("../w3ccrypto/provider"),r=e("../common/error"),o=function(e){switch(e){case"w3c":return window.crypto||window.msCrypto;case"SkyTrust":return new t;default:throw new r.NoSuchProviderError}};return{getCryptoProviderByName:o}}),define("iframe/receiver",["require","../common/component","../common/crypto-object"],function(e){var t=e("../common/component"),r=e("../common/crypto-object"),o=function(){var e=this,t=function(){console.log("[iframe] init post message listener"),window.addEventListener("message",o,!1)},o=function(t){console.log("[iframe] received post message ..."),console.log("[iframe] postMessage origin: "+t.origin);var o=JSON.parse(t.data);console.log("[iframe] data received post message");var n=new r(o.payload);n.setHeader(o.header),n.setRequestID(o.requestID),n.resolve=function(){console.log("[iframe] sending post message back ..."),t.source.postMessage(n.jsonWithRequestID(),"*")},n.reject=function(e){console.log("[iframe] sending post message back ..."),n.payload.nodeError=e.toString(),t.source.postMessage(n.jsonWithRequestID(),"*")},e.send("communication",n)};this.onReceive=function(e){console.log("[iframe] received at receiver component"),e.resolve()},t()};return o.prototype=Object.create(t),o}),define("iframe/authentication",["require","../common/component","../common/protocol"],function(e){var t=e("../common/component"),r=e("../common/protocol"),o=function(){var e=this,t=function(t){var o=t.data,n=$("#loginusername").val(),i=$("#loginpassword").val();console.log("[iframe] user name: "+n),console.log("[iframe] password: "+i),r.setUserPasswortAuth(o,n,i),console.log("[iframe] object after auth"),console.log(o.json()),$("#loginform").hide(),$("#loginform").off("submit"),e.send("communication",o)};if(this.onReceive=function(e){console.log("[iframe] received at authentication component"),$("#loginform").show(),$("#loginform-message").hide(),$("#loginform").submit(e,t),"609"===r.getError(e)&&($("#loginform-message").html("Invalid username/password"),$("#loginform-message").show())},this.window===window)throw Error("Authentication called statically")};return o.prototype=Object.create(t),o}),define("iframe/communication",["require","../common/component","../skytrust-config","../common/protocol"],function(e){var t=e("../common/component"),r=e("../skytrust-config"),o=e("../common/protocol"),n=function(){var e="",t=this,n=function(e){var o=e.json();$.ajax({url:r.server,method:"post",dataType:"json",processData:!1,contentType:"application/json",data:o}).done(function(t){i(t,e,o)}).fail(function(r,o,n){console.log("[iframe] request error "+n);var i={type:"status",code:r.status};console.log(r),e.setPayload(i),t.send("receiver",e)})},i=function(r,n,i){console.log("[iframe] ajax response received");var s=n;s.setHeader(r.header),s.setPayload(r.payload),console.log(n.getHeader());var a=s.getHeader().sessionId;if(e!==a&&(console.log("[iframe] setting session ID: "+a),e=a),o.isAuthRequired(s)){var c=o.getAuthTypes(s);$.inArray("authChallengeRequest",c)&&t.send("authentication",s)}else if("609"===o.getError(s)){console.log("[iframe] wrong username/password");var u=o.getCommandId(JSON.parse(i).header);console.log("header command id: "+u),o.setCommandId(s,u),t.send("authentication",s)}else t.send("receiver",n)};this.onReceive=function(t){if(console.log("[iframe] received at communication component"),null===t.getHeader()){var r=o.getBlankHeader();console.log("[iframe] header was blank, setting new header"),t.setHeader(r)}o.setSessionId(t,e),n(t)}};return n.prototype=Object.create(t),n}),define("iframe/element",["require","../common/router","../iframe/receiver","../iframe/authentication","../iframe/communication"],function(e){var t=e("../common/router"),r=e("../iframe/receiver"),o=e("../iframe/authentication"),n=e("../iframe/communication"),i=function(){var e=null,i={},s=function(t,r){return i.hasOwnProperty(t)?!1:(i[t]=r,void(r.send=function(r,o){e.route(t,r,o)}))};if(this.operation=null,this.getComponent=function(e){return i.hasOwnProperty(e)?i[e]:!1},this.window===window)throw Error("Element called statically");e=new t(this),s("receiver",new r),s("authentication",new o),s("communication",new n),this.operation=i.receiver.operation};return i}),requirejs.config({paths:{jQuery:"https://code.jquery.com/jquery-1.11.2.min"},shim:{jQuery:{exports:"$"}}}),requirejs(["jQuery","skytrust-config","w3ccrypto/providerDef","iframe/element"],function(e,t,r,o){"undefined"!=typeof ___skytrust_javascript_iframe___?(console.log("[iframe] initializing SkyTrust"),new o,e("#loginserver").val(t.server)):(console.log("[w3c   ] initializing SkyTrust: window.getCryptoProviderByName()"),window.getCryptoProviderByName=r.getCryptoProviderByName)}),define("skytrust",function(){});