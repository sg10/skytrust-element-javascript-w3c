/*! skytrust-javascript-element - v1.0.0 - 2015-04-09
* Copyright (c) 2015 Stefan Gruber; Licensed MIT */
define("common/crypto-object",[],function(){var e=function(e){var r={},t={},o=-1,n=0;this.resolve=function(){},this.reject=function(){},this.setHeader=function(e){r=JSON.parse(JSON.stringify(e))},this.getHeader=function(){return r},this.setPayload=function(e){t=JSON.parse(JSON.stringify(e))},this.getPayload=function(){return t},this.setRequestID=function(e){o=e},this.getRequestID=function(){return o},this.setErrorCode=function(e){n=e},this.getErrorCode=function(){return n},this.jsonSkyTrust=function(){return JSON.stringify({header:r,payload:t})},this.jsonInternal=function(){return JSON.stringify({header:r,payload:t,requestID:o,error:n})},this.toString=function(){return"[CryptoObject #"+o+"] header="+r+", payload="+t+", requestID="+o+", error="+n},e&&this.setPayload(e)};return e}),define("common/router",["require","../common/crypto-object"],function(e){var r=e("../common/crypto-object"),t=function(e){var o="";if(this.route=function(e,t,n){if(console.log("[common][router]  FROM="+e+" TO="+t),!(n instanceof r))throw new Error("Router can only transmit instances of CryptoObject");if(o.getComponent(t)===!1)throw new Error("Router, receiver: no component named "+t);if(o.getComponent(e)===!1)throw new Error("Router, sender: no component named "+e);if(!o.getComponent(t).onReceive)throw new Error("Router: onReceive() method not defined");o.getComponent(t).onReceive(n)},!(this instanceof t))throw new Error("Router called statically");o=e};return t}),define("common/component",[],function(){var e=function(){if(!(this instanceof e))throw new Error("Component called statically")};return e.prototype.send=function(e,r){console.log("[WARNING] abstract method was not overwritten"),console.log("to="+e+", object="+r)},e.prototype.onReceive=function(e){console.log("[WARNING] abstract method was not overwritten"),console.log("object="+e)},e}),define("common/error",["require"],function(){var e={};return e.NotYetImplementedError=function(e){Error.call(this),this.name="NotYetImplementedException",this.message=e,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.NotYetImplementedError.prototype=Object.create(Error.prototype),e.NoSuchProviderError=function(){Error.call(this),this.name="NoSuchProviderError",this.message="Provider does not exist.",this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.NoSuchProviderError.prototype=Object.create(Error.prototype),e.UnauthorizedError=function(){Error.call(this),this.name="UnauthorizedError",this.message="Please authorize, no active or invalid session.",this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.UnauthorizedError.prototype=Object.create(Error.prototype),e.KeyError=function(e){Error.call(this),this.name="KeyError",this.message="CryptoKey provided to an operation does not meet requirements"+(null!==e?":"+e:""),this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.KeyError.prototype=Object.create(Error.prototype),e.SkyTrustError=function(e,r){Error.call(this),this.name="KeyError",this.message="CryptoKey provided to an operation does not meet requirements"+(null!==r?": "+r:""),this.code=e,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.SkyTrustError.prototype=Object.create(Error.prototype),e.QuotaExceededError=function(e){Error.call(this),this.name="QuotaExceededError",this.message=e,this.code=22,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.QuotaExceededError.prototype=Object.create(Error.prototype),e.InvalidAccessError=function(){Error.call(this),this.name="InvalidAccessError",this.message="The requested operation is not valid for the provided key.",this.code=15,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.InvalidAccessError.prototype=Object.create(Error.prototype),e.SyntaxError=function(){Error.call(this),this.name="SyntaxError",this.message="A required parameter was missing or out-of-range",this.code=12,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.SyntaxError.prototype=Object.create(Error.prototype),e.NotSupportedError=function(e){Error.call(this),this.name="NotSupportedError",this.message="This algorithm is not supported: "+e,this.code=9,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.NotSupportedError.prototype=Object.create(Error.prototype),e.OperationNotSupportedError=function(){Error.call(this),this.name="OperationNotSupported",this.message="SkyTrust doesn't support this operation.",this.code=9,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.OperationNotSupportedError.prototype=Object.create(Error.prototype),e.InvalidStateError=function(){Error.call(this),this.name="InvalidStateError",this.message="The requested operation is not valid for the current state of the provided key.",this.code=11,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.InvalidStateError.prototype=Object.create(Error.prototype),e.OperationError=function(){Error.call(this),this.name="OperationError",this.message="The operation failed for an operation-specific reason.",this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.OperationError.prototype=Object.create(Error.prototype),e.UnknownError=function(){Error.call(this),this.name="UnknownError",this.message="The operation failed for an unknown transient reason (e.g. out of memory).",this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.UnknownError.prototype=Object.create(Error.prototype),e.DataError=function(e){Error.call(this),this.name="DataError",this.message="Data provided to an operation does not meet requirements"+(null!==e?":"+e:""),this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.DataError.prototype=Object.create(Error.prototype),e.TypeMismatchError=function(e){Error.call(this),this.name="TypeMismatchError",this.message=e,this.stack=(new Error).stack,this.toStringError=function(){return"Error: "+this.name+": "+this.message}},e.TypeMismatchError.prototype=Object.create(Error.prototype),e}),define("common/util",["require","../common/error"],function(e){var r=e("../common/error"),t={};return t.arrayBufferToBase64=function(e){for(var r="",t=new Uint8Array(e.buffer?e.buffer:e),o=t.byteLength,n=0;o>n;n++)r+=String.fromCharCode(t[n]);return window.btoa(r)},t.base64ToArrayBuffer=function(e){for(var r=window.atob(e),t=r.length,o=new Uint8Array(t),n=0;t>n;n++)o[n]=r.charCodeAt(n);return o.buffer},t.arrayBufferToBase64_array=function(e){if(!($.isArray(e)||e[0]instanceof ArrayBuffer))return[];var r=[];return $.each(e,function(e,o){r.push(t.arrayBufferToBase64(o))}),r},t.base64ToArrayBuffer_array=function(e){if(!$.isArray(e))return[];var r=[];return $.each(e,function(e,o){r.push(t.base64ToArrayBuffer(o))}),r},t.isArrayBufferView=function(e){return e&&e.buffer instanceof ArrayBuffer&&void 0!==e.byteLength},t.inArray=function(e,r){if(!r||!r.length)return!1;for(var t=e.toLowerCase(),o=0;o<r.length;o++)if(t===r[o].toLowerCase())return r[o];return!1},t.copyOf=function(e){var r;if("string"==typeof e)return""+e;if("number"==typeof e||"boolean"==typeof e)return e;if("[object Date]"===Object.prototype.toString.call(e))return r=new Date,r.setTime(e.getTime()),r;if(Array.isArray(e)){r=[];for(var o=0;o<e.length;o++)r[o]=t.copyOf(e[o]);return r}if(e instanceof ArrayBuffer)return e.slice(0);if("object"==typeof e||e instanceof Object)return $.extend(!0,{},e);throw new Error("Copying type "+typeof e+" is not supported!")},t.rejectedPromise=function(e){return new Promise(function(r,t){t(e)})},t.warningIfNotNull=function(e){$.each(e,function(e,r){null!=r&&console.warn("Parameter '"+e+"' is not used via this API. To disable this warning, set it to null.")})},t.throwNotSupportedError=function(){throw new r.OperationNotSupportedError},t}),define("common/protocol",["require","../common/util","jQuery"],function(e){var r=e("../common/util"),t=e("jQuery"),o={},n=function(e,r){var t=r.split("."),o=e;try{for(var n=0;n<t.length;n++){if(!o.hasOwnProperty(r[n]))throw new Error;o=o[r[n]]}}catch(i){throw new SkyError(0,"key '"+r+"' does not exist")}return o},i=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return a(e);for(var r=[],t=0;t<e.length;t++)r.push(a(e[t]));return r},a=function(e){if(null==e||!e.keyType)return null;var r={type:e.keyType};return("handle"===e.keyType||"internalCertificate"===e.keyType)&&(r.id=e.id,r.subId=e.subId),"internalCertificate"===e.keyType&&(r.encodedCertificate=e.encodedCertificate),"wrappedKey"===e.keyType&&(r.encodedWrappedKey=e.encodedWrappedKey),"externalCertificate"===e.keyType&&(r.encodedCertificate=e.encodedCertificate),r};return o.getBlankHeader=function(){var e={type:"standardSkyTrustHeader",commandId:"",sessionId:"",path:["java-api-instance"],protocolVersion:"2.0"};return e},o.setBlankHeader=function(e){e.setHeader(o.getBlankHeader())},o.setDiscoverKeysRequest=function(e){var r={type:"discoverKeysRequest",representation:"handle"};e.setPayload&&e.setPayload(r)},o.setSessionId=function(e,r){if(e.getHeader){var t=e.getHeader();t.sessionId=r,e.setHeader(t)}else e.sessionId=r},o.getSessionId=function(e){return e.getHeader?n(e.getHeader(),"sessionId"):void 0},o.setUserPasswortAuth=function(e,r,t){var o={type:"authChallengeResponse",authInfo:{type:"UserNamePasswordAuthInfo",userName:r,passWord:t}};e.setPayload&&e.setPayload(o)},o.setEncryptRequest=function(e,t,o,n){var i=r.arrayBufferToBase64(n),s={type:"encryptRequest",encryptionKeys:[a(o)],algorithm:t,plainData:[i]};e.setPayload&&e.setPayload(s)},o.setDecryptRequest=function(e,t,o,n){var i=r.arrayBufferToBase64(n),s={type:"decryptRequest",decryptionKey:a(o),algorithm:t,encryptedData:[i]};e.setPayload&&e.setPayload(s)},o.setEncryptCMSRequest=function(e,o,n,i){var s=r.arrayBufferToBase64_array(i),c=[];t.each(n,function(e,r){c.push(a(r))});var u={type:"encryptCMSRequest",encryptionKeys:c,algorithm:o,plainData:s};e.setPayload&&e.setPayload(u)},o.setDecryptCMSRequest=function(e,t,o,n){var i=r.arrayBufferToBase64_array(n),s={type:"decryptCMSRequest",decryptionKey:a(o),encryptedCMSData:i};e.setPayload&&e.setPayload(s)},o.setSignRequest=function(e,t,o,n){var i=r.arrayBufferToBase64(n),s={type:"signRequest",signatureKey:a(o),algorithm:t,hashesToBeSigned:[i]};e.setPayload&&e.setPayload(s)},o.setGenerateWrappedKeyRequest=function(e,r,t,o,n){var s=a(o),c={type:"generateWrappedKeyRequest",encryptionKeys:i(t),keyType:r,certificateSubject:n};null!=s&&(c.signingKey=s),e.setPayload&&e.setPayload(c)},o.isAuthRequired=function(e){var r=e.getPayload();return r&&"authChallengeRequest"===r.type?!0:!1},o.getAuthTypes=function(e){for(var r=e.getPayload().authTypes,t=[],o=0;r&&o<r.length;o++)t.push(r[o].type);return t},o.getError=function(e){var r=e.getPayload();return r&&"status"===r.type?r.code:!1},o.getCommandId=function(e){return e.getHeader?e.getHeader().commandId:e.commandId},o.setCommandId=function(e,r){e.getHeader||(e.commandId=r),e.getHeader().commandId=r},o.supportedAlgorithms={encrypt:["RSA-OAEP","RSAES-PKCS1-v1_5","RSAES-RAW"],sign:["RSASSA-PKCS1-v1_5-SHA-1","RSASSA-PKCS1-v1_5-SHA-224","RSASSA-PKCS1-v1_5-SHA-256","RSASSA-PKCS1-v1_5-SHA-512"],cms:["CMS-AES-128-CBC","CMS-AES-192-CBC","CMS-AES-256-CBC","CMS-AES-128-GCM","CMS-AES-192-GCM","CMS-AES-256-GCM","CMS-AES-128-CCM","CMS-AES-192-CCM","CMS-AES-256-CCM"],wrapped:["RSA-2048","RSA-4096"]},o}),define("common/key",["require","./util"],function(e){var r=(e("./util"),function(e,t){if(!(this instanceof r))throw new Error("CryptoKey called statically");if(Object.defineProperty(this,"keyType",{value:e}),"handle"===e||"internalCertificate"===e)Object.defineProperty(this,"id",{value:t.id}),Object.defineProperty(this,"subId",{value:t.subId}),"internalCertificate"===e&&Object.defineProperty(this,"encodedCertificate",{value:t.encodedCertificate}),Object.defineProperty(this,"extractable",{value:!1});else if("wrappedKey"===e)Object.defineProperty(this,"encodedWrappedKey",{value:t.encodedWrappedKey}),Object.defineProperty(this,"encodedX509Certificate",{value:t.encodedX509Certificate}),Object.defineProperty(this,"extractable",{value:!0});else{if("externalCertificate"!==e)throw new KeyError("Invalid keyType specified: "+e);Object.defineProperty(this,"encodedCertificate",{value:t.encodedCertificate}),Object.defineProperty(this,"extractable",{value:!0})}Object.defineProperty(this,"type",{value:"secret"}),Object.defineProperty(this,"algorithm",{value:null}),Object.defineProperty(this,"usages",{value:null})});return r.prototype.toString=function(){var e="[CryptoKey] ";return"handle"===this.keyType||"encodedCertificate"===this.keyType?(e=e+"id="+this.id+", subId="+this.subId,"internalCertificate"===this.keyType&&(e=e+" certificate="+this.encodedCertificate.substr(0,8)+"...")):"wrappedKey"===this.keyType?e=e+"wrappedKey="+this.encodedWrappedKey.substr(0,3)+"..."+this.encodedWrappedKey.substr(550,7)+"...":"externalCertificate"===this.keyType&&(e=e+"certificate="+this.encodedCertificate.substr(0,3)+"..."+this.encodedCertificate.substr(550,7)+"..."),e},r}),define("w3ccrypto/receiver",["require","../common/component","../common/crypto-object","../common/protocol","../skytrust-config","../common/util","../common/error","../common/key"],function(e){var r=e("../common/component"),t=e("../common/crypto-object"),o=e("../common/protocol"),n=(e("../skytrust-config"),e("../common/util")),i=e("../common/error"),a=e("../common/key"),s=function(){var e=this,r=function(e,r){var t=e.name?e.name:e;t=(""+t).toLowerCase();var a=(""+r).toLowerCase(),s="decrypt"===a?"encrypt":a,c=o.supportedAlgorithms[s],u=n.inArray(t,c);if(!c||!u)throw new i.NotSupportedError(t);return u},s=function(o,s,c,u,p){if($.isArray(u))$.each(u,function(e,r){return r instanceof a?void 0:n.rejectedPromise(new i.KeyError("not an array"))});else if(!(u instanceof a))return n.rejectedPromise(new i.KeyError);if($.isArray(p))$.each(p,function(e,r){return r instanceof ArrayBuffer||n.isArrayBufferView(r)?void 0:n.rejectedPromise(new i.DataError("Data is not a valid ArrayBuffer/ArrayBufferView array"))});else if(!(p instanceof ArrayBuffer||n.isArrayBufferView(p)))return n.rejectedPromise(new i.DataError("Data is not a valid ArrayBuffer/ArrayBufferView"));try{c=r(c,s)}catch(d){return n.rejectedPromise(d)}return new Promise(function(r,n){var i=new t;o(i,c,u,p),i.resolve=r,i.reject=n,e.send("communication",i)})},c={encrypt:{request:function(e,r,t){return $.isArray(r)?$.isArray(t)?s(o.setEncryptRequest,"encrypt",e,r,n.copyOf(t)):n.rejectedPromise(new i.DataError("Data can't to be an array")):n.rejectedPromise(new i.KeyError("Key can't be an array"))},response:function(e,r){r.encryptedData[0]&&r.encryptedData[0][0]?e.resolve(n.base64ToArrayBuffer(r.encryptedData[0][0])):e.rejected(new i.SkyTrustError(e.getErrorCode()))}},decrypt:{request:function(e,r,t){return $.isArray(r)?$.isArray(t)?s(o.setDecryptRequest,"decrypt",e,r,n.copyOf(t)):n.rejectedPromise(new i.DataError("Data can't to be an array")):n.rejectedPromise(new i.KeyError("Key can't be an array"))},response:function(e,r){e.resolve(n.base64ToArrayBuffer(r.plainData[0]))}},sign:{request:function(e,r,t){return $.isArray(r)?$.isArray(t)?s(o.setSignRequest,"sign",e,r,n.copyOf(t)):n.rejectedPromise(new i.DataError("Data can't to be an array")):n.rejectedPromise(new i.KeyError("Key can't be an array"))},response:function(e,r){e.resolve(n.base64ToArrayBuffer(r.signedHashes[0]))}},encryptCMS:{request:function(e,r,t){return $.isArray(r)?$.isArray(t)?s(o.setEncryptCMSRequest,"cms",e,r,n.copyOf(t)):n.rejectedPromise(new i.DataError("Data has to be an array")):n.rejectedPromise(new i.KeyError("Key has to be an array"))},response:function(e,r){e.resolve(n.base64ToArrayBuffer_array(r.encryptedCMSData))}},decryptCMS:{request:function(e,r,t){return $.isArray(r)?n.rejectedPromise(new i.KeyError("Key can't be an array")):$.isArray(t)?s(o.setDecryptCMSRequest,"cms",e,r,n.copyOf(t)):n.rejectedPromise(new i.DataError("Data has to be an array"))},response:function(e,r){e.resolve(n.base64ToArrayBuffer_array(r.plainData))}},discoverKeys:{request:function(){return new Promise(function(r,n){var i=new t;o.setDiscoverKeysRequest(i),i.resolve=r,i.reject=n,e.send("communication",i)})},response:function(e,r){for(var t=r.key,o=[],n=0;n<t.length;n++){var i={id:t[n].id,subId:t[n].subId};o.push(new a("handle",i))}e.resolve(o)}},generateWrappedKey:{request:function(i,a,s,c){var u=n.copyOf(c);try{i=r(i,"wrapped")}catch(p){return rejectedPromise(p)}return new Promise(function(r,n){var c=new t;o.setGenerateWrappedKeyRequest(c,i,a,s,u),c.resolve=r,c.reject=n,e.send("communication",c)})},response:function(e,r){var t=new a("wrappedKey",r);e.resolve(t)}},exportKey:function(e,r){return new Promise(function(t,o){r instanceof a||o(new i.KeyError(r)),r.extractable!==!0&&o(new i.InvalidAccessError),"wrapped"===e?t({encodedWrappedKey:r.encodedWrappedKey,encodedX509Certificate:r.encodedX509Certificate}):"x509"===e?t({encodedCertificate:r.encodedCertificate}):o(new Error("invalid export format"))})},importKey:function(e,r){n.copyOf(r);return new Promise(function(t,o){var n={x509:"externalCertificate",id:"handle",wrapped:"wrappedKey"};if(n.hasOwnProperty(e)){var s=new a(n[e],r);t(s)}else o(new i.NotSupportedError(e))})}};this.onReceive=function(e){console.log("[w3c   ] received at receiver component"),console.log(e.jsonInternal().substr(0,1e3));var r=o.getError(e);if(r!==!1)e.reject(new Error("SkyTrust/HTTP error code "+r));else{var t=e.getPayload(),n=t.type,i={decryptResponse:c.decrypt.response,encryptResponse:c.encrypt.response,signResponse:c.sign.response,encryptCMSResponse:c.encryptCMS.response,decryptCMSResponse:c.decryptCMS.response,discoverKeysResponse:c.discoverKeys.response,generateWrappedKeyResponse:c.generateWrappedKey.response};try{i[n](e,t)}catch(a){e.reject(a)}}},this.operation={encrypt:c.encrypt.request,decrypt:c.decrypt.request,sign:c.sign.request,encryptCMS:c.encryptCMS.request,decryptCMS:c.decryptCMS.request,discoverKeys:c.discoverKeys.request,generateWrappedKey:c.generateWrappedKey.request,exportKey:c.exportKey,importKey:c.importKey}};return s.prototype=Object.create(r),s}),define("w3ccrypto/communication",["require","../common/component","../common/protocol"],function(e){var r=e("../common/component"),t=e("../common/protocol"),o=function(e){var r="",n=this,i={},a=!1,s=function(){console.log("[w3c   ] init post message listener"),window.addEventListener("message",d,!1)},c=function(e){var t=document.getElementById(r);console.log("[w3c   ] data to send: "),console.log(e.jsonInternal().substr(0,1e3));var o="";do o=Math.round(1e6*Math.random());while(i.hasOwnProperty(o));e.setRequestID(o),i[o]=e;var n=e.jsonInternal();if(a===!1)var s=window.setInterval(function(){a===!0&&(window.clearInterval(s),t.contentWindow.postMessage(n,"*")),console.log("[w3c   ] request "+o+", waiting for IFrame to be loaded")},500);else t.contentWindow.postMessage(n,"*");console.log("[w3c   ] pending requests: "+Object.keys(i).length)},u=function(e){var r=i[e];return i[e]&&delete i[e],r},p=function(e){console.log("[w3c   ] sending post message to iframe ..."),c(e)},d=function(e){if(console.log("[w3c   ] received post message ..."),console.log("[w3c   ] postMessage origin: "+e.origin),console.log("[w3c   ] postMessage data:"),console.log((e.data+"").substr(0,1e3)),"hello-skytrust"===e.data)return console.log("[w3c   ] recevied 'alive-message': SkyTrust IFrame element loaded"),void(a=!0);var r=JSON.parse(e.data),t=u(r.requestID);if(!t)throw new Error("no matching request with ID '"+r.requestID+"' found!");t.setPayload(r.payload),t.setHeader(r.header),n.send("receiver",t)};if(this.onReceive=function(e){console.log("[w3c   ] received at communication component"),t.setBlankHeader(e),p(e)},!(this instanceof o))throw new Error("Communication called statically");r=e,s()};return o.prototype=Object.create(r),o}),define("w3ccrypto/element",["require","../common/router","../w3ccrypto/receiver","../w3ccrypto/communication","jQuery"],function(e){var r=e("../common/router"),t=e("../w3ccrypto/receiver"),o=e("../w3ccrypto/communication"),n=e("jQuery"),i=function(){var a={},s=new r(this),c="skytrust-iframe",u=e.toUrl("skytrust-iframe.html"),p=function(e,r){return a.hasOwnProperty(e)?!1:(a[e]=r,void(r.send=function(r,t){s.route(e,r,t)}))};if(this.operation={},this.getComponent=function(e){return a.hasOwnProperty(e)?a[e]:!1},!(this instanceof i))throw new Error("Element called statically");n(document).ready(function(){console.log("[w3c   ] loading iframe target ..."),n("#"+c).attr("src",u)}),p("receiver",new t),p("communication",new o(c)),this.operation=a.receiver.operation};return i}),define("w3ccrypto/provider",["require","../w3ccrypto/element","../common/error","../common/key","../common/util"],function(e){var r=e("../w3ccrypto/element"),t=e("../common/error"),o=e("../common/key"),n=e("../common/util"),i=null,a=function(){null===i&&(i=new r),this.subtle={},this.extended={},this.subtle.CryptoKey=o,this.subtle.encrypt=function(e,r,t){return i.operation.encrypt(e,r,t)},this.subtle.decrypt=function(e,r,t){return i.operation.decrypt(e,r,t)},this.subtle.sign=function(e,r,t){return i.operation.sign(e,r,t)},this.subtle.generateKey=function(e,r,t,o,a,s){return n.warningIfNotNull({extractable:r,keyUsages:t}),i.operation.generateWrappedKey(e,o,a,s)},this.subtle.exportKey=function(e,r){return i.operation.exportKey(e,r)},this.subtle.importKey=function(e,r,t,o,a){return n.warningIfNotNull({algorithm:t,extractable:o,keyUsages:a}),i.operation.importKey(e,r)},this.subtle.deriveKey=n.throwNotSupportedError,this.subtle.deriveBits=n.throwNotSupportedError,this.subtle.verify=n.throwNotSupportedError,this.subtle.digest=n.throwNotSupportedError,this.subtle.wrapKey=function(){throw new t.NotYetImplementedException},this.extended.listKeys=i.operation.discoverKeys,this.extended.encryptCMS=i.operation.encryptCMS,this.extended.decryptCMS=i.operation.decryptCMS};return a}),define("w3ccrypto/providerDef",["require","../w3ccrypto/provider","../common/error"],function(e){var r=e("../w3ccrypto/provider"),t=e("../common/error"),o=function(e){switch(e){case"w3c":return window.crypto||window.msCrypto;case"SkyTrust":return new r;default:throw new t.NoSuchProviderError}};return{getCryptoProviderByName:o}}),define("iframe/receiver",["require","../common/component","../common/crypto-object"],function(e){var r=e("../common/component"),t=e("../common/crypto-object"),o=function(){var e=this,r=function(){console.log("[iframe] init post message listener"),window.addEventListener("message",o,!1),window.parent.postMessage("hello-skytrust","*")},o=function(r){console.log("[iframe] received post message ..."),console.log("[iframe] postMessage origin: "+r.origin);var o=JSON.parse(r.data);console.log("[iframe] data received post message");var n=new t(o.payload);n.setHeader(o.header),n.setRequestID(o.requestID),n.resolve=function(){console.log("[iframe] sending post message back ..."),r.source.postMessage(n.jsonInternal(),"*")},n.reject=function(e){console.log("[iframe] sending post message back ..."),n.payload.nodeError=e.toString(),r.source.postMessage(n.jsonInternal(),"*")},e.send("communication",n)};this.onReceive=function(e){console.log("[iframe] received at receiver component"),e.resolve()},r()};return o.prototype=Object.create(r),o}),define("iframe/authentication",["require","../common/component","../common/protocol"],function(e){var r=e("../common/component"),t=e("../common/protocol"),o=function(){var e=this,r=function(r){var o=r.data,n=$("#loginusername").val(),i=$("#loginpassword").val();console.log("[iframe] user name: "+n),console.log("[iframe] password: "+i),t.setUserPasswortAuth(o,n,i),console.log("[iframe] object after auth"),console.log(o.jsonInternal().substr(0,200)),$("#loginform").hide(),$("#loginform").off("submit"),e.send("communication",o)};if(this.onReceive=function(e){console.log("[iframe] received at authentication component"),$("#loginform").show(),$("#loginform-message").hide(),$("#loginform").submit(e,r),"609"===t.getError(e)&&($("#loginform-message").html("Invalid username/password"),$("#loginform-message").show())},!(this instanceof o))throw Error("Authentication called statically")};return o.prototype=Object.create(r),o}),define("iframe/communication",["require","../common/component","../skytrust-config","../common/protocol"],function(e){var r=e("../common/component"),t=e("../skytrust-config"),o=e("../common/protocol"),n=function(){var e="",r=this,n=function(e){var o=e.jsonSkyTrust();$.ajax({url:t.server,method:"post",dataType:"json",processData:!1,contentType:"application/json",data:o}).done(function(r){i(r,e,o)}).fail(function(t,o,n){console.log("[iframe] request error "+n),e.setErrorCode(t.status),r.send("receiver",e)})},i=function(t,n,i){console.log("[iframe] ajax response received");var a=n;a.setHeader(t.header),a.setPayload(t.payload),console.log(n.getHeader());var s=a.getHeader().sessionId;if(e!==s&&(console.log("[iframe] setting session ID: "+s),e=s),o.isAuthRequired(a)){var c=o.getAuthTypes(a);$.inArray("authChallengeRequest",c)&&r.send("authentication",a)}else if("609"===o.getError(a)){console.log("[iframe] wrong username/password");var u=o.getCommandId(JSON.parse(i).header);console.log("header command id: "+u),o.setCommandId(a,u),r.send("authentication",a)}else r.send("receiver",n)};this.onReceive=function(r){if(console.log("[iframe] received at communication component"),null===r.getHeader()){var t=o.getBlankHeader();console.log("[iframe] header was blank, setting new header"),r.setHeader(t)}o.setSessionId(r,e),n(r)}};return n.prototype=Object.create(r),n}),define("iframe/element",["require","../common/router","../iframe/receiver","../iframe/authentication","../iframe/communication"],function(e){var r=e("../common/router"),t=e("../iframe/receiver"),o=e("../iframe/authentication"),n=e("../iframe/communication"),i=function(){var e=null,a={},s=function(r,t){return a.hasOwnProperty(r)?!1:(a[r]=t,void(t.send=function(t,o){e.route(r,t,o)}))};if(this.operation=null,this.getComponent=function(e){return a.hasOwnProperty(e)?a[e]:!1},!(this instanceof i))throw new Error("Element called statically");e=new r(this),s("receiver",new t),s("authentication",new o),s("communication",new n),this.operation=a.receiver.operation};return i}),requirejs.config({paths:{jQuery:"https://code.jquery.com/jquery-1.11.2.min"},shim:{jQuery:{exports:"$"}}}),requirejs(["jQuery","skytrust-config","w3ccrypto/providerDef","iframe/element"],function(e,r,t,o){"undefined"!=typeof ___skytrust_javascript_iframe___?(console.log("[iframe] initializing SkyTrust"),new o,e("#loginserver").val(r.server)):(console.log("[w3c   ] initializing SkyTrust: window.getCryptoProviderByName()"),window.getCryptoProviderByName=t.getCryptoProviderByName)}),define("skytrust",function(){});